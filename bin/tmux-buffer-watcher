#! env bash
#
# https://robots.thoughtbot.com/how-to-copy-and-paste-with-tmux-on-mac-os-x

# Bail if tmux is not running
tmux has-session &> /dev/null || { exit 0; }

# Bail if the is already an instance running
source my-mutex
mutex /usr/local/var/run/tmux-buffer-watcher.lock || { exit 0; }

# Check every second if there is something on tmux's buffer.
# Send it to pbcopy and then delete the buffer.
while true; do
    if test -n "`tmux showb 2> /dev/null`"; then
        tmux saveb -|pbcopy && tmux deleteb
    fi
    sleep 1
done
